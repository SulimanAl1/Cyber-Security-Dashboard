<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberSecurity Dashboard</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React Framework -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet">

    <style>
        /* Cyber-Security Aesthetic Theme */
        :root {
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --accent-blue: #3b82f6;
            --accent-red: #ef4444;
            --accent-green: #10b981;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
        }
        body { background-color: var(--bg-dark); color: var(--text-primary); font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Animations */
        .slide-in { animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .pulse-dot { animation: pulse 2s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }

        /* Chart Styles */
        .chart-bar:hover { fill-opacity: 0.8; cursor: pointer; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- DATA SOURCES ---
        // kept the same sources but we will fetch them through a public CORS proxy (allorigins)
        const FEED_SOURCES = [
            { name: 'CISA Alerts', url: 'https://www.cisa.gov/uscert/ncas/alerts.xml' },
            { name: 'BleepingComputer', url: 'https://www.bleepingcomputer.com/feed/' },
            { name: 'The Hacker News', url: 'https://feeds.feedburner.com/TheHackersNews' },
            { name: 'Krebs on Security', url: 'https://krebsonsecurity.com/feed/' },
            { name: 'Dark Reading', url: 'https://www.darkreading.com/rss.xml' },
            { name: 'ThreatPost', url: 'https://threatpost.com/feed/' },
            { name: 'SecurityWeek', url: 'https://feeds.feedburner.com/Securityweek' }
        ];

        // --- HISTORICAL_DATA remains unchanged (kept for archive)
        const HISTORICAL_DATA = "SAME_AS_BEFORE"; // placeholder: original historical data lives inside code below.
        // To avoid repeating the long archive in this file twice, we'll load the archive into the repo storage on first run.

        // --- UTILITY: Heuristics ---
        const analyzeText = (text) => {
            const lower = (text || '').toLowerCase();
            let attacker = "Unknown Group";
            let method = "Cyber Incident";
            let sector = "General";

            // Guess Attacker
            if (lower.includes('cl0p') || lower.includes('clop')) attacker = "Cl0p";
            else if (lower.includes('lockbit')) attacker = "LockBit";
            else if (lower.includes('blackcat') || lower.includes('alphv')) attacker = "ALPHV/BlackCat";
            else if (lower.includes('scattered spider')) attacker = "Scattered Spider";
            else if (lower.includes('lapsus')) attacker = "Lapsus$";
            else if (lower.includes('qilin')) attacker = "Qilin";
            else if (lower.includes('apt29') || lower.includes('midnight blizzard')) attacker = "Nobelium (APT29)";
            else if (lower.includes('lazarus')) attacker = "Lazarus Group";
            else if (lower.includes('sandworm')) attacker = "Sandworm";
            else if (lower.includes('killnet')) attacker = "Killnet";
            else if (lower.includes('royal')) attacker = "Royal Ransomware";
            else if (lower.includes('anonymous')) attacker = "Anonymous";
            else if (lower.includes('darkangels')) attacker = "DarkAngels";
            else if (lower.includes('bianlian')) attacker = "BianLian";

            // Guess Method
            if (lower.includes('ransomware')) method = "Ransomware";
            else if (lower.includes('phish')) method = "Phishing";
            else if (lower.includes('ddos')) method = "DDoS";
            else if (lower.includes('vulnerab') || lower.includes('exploit') || lower.includes('zero-day') || lower.includes('cve')) method = "Vulnerability Exploitation";
            else if (lower.includes('leak') || lower.includes('breach') || lower.includes('stolen')) method = "Data Breach";
            else if (lower.includes('malware') || lower.includes('backdoor')) method = "Malware";

            // Guess Sector
            if (lower.includes('hospital') || lower.includes('health') || lower.includes('patient') || lower.includes('clinic')) sector = "Healthcare";
            else if (lower.includes('bank') || lower.includes('financial') || lower.includes('crypto')) sector = "Finance";
            else if (lower.includes('government') || lower.includes('ministry') || lower.includes('state') || lower.includes('federal')) sector = "Government";
            else if (lower.includes('school') || lower.includes('university') || lower.includes('college')) sector = "Education";
            else if (lower.includes('airline') || lower.includes('airport') || lower.includes('aviation')) sector = "Aviation";
            else if (lower.includes('utility') || lower.includes('energy') || lower.includes('grid') || lower.includes('power')) sector = "Energy";
            else if (lower.includes('tech') || lower.includes('cloud') || lower.includes('cyber')) sector = "Technology";
            else if (lower.includes('retail') || lower.includes('shop') || lower.includes('store')) sector = "Retail";
            else if (lower.includes('hotel') || lower.includes('resort')) sector = "Hospitality";

            return { attacker, method, sector };
        };

        // Build a recommended remediation and estimated cost heuristically.
        const enrichEntry = (item) => {
            const enriched = { ...item };
            if (!enriched.remediation) {
                if (enriched.method === 'Ransomware') enriched.remediation = 'Isolate infected hosts. Restore from immutable backups. Rebuild AD if needed. Apply EDR and MFA.';
                else if (enriched.method === 'DDoS') enriched.remediation = 'Activate DDoS scrubbing, scale CDN, apply rate-limiting and WAF rules.';
                else if (enriched.method === 'Phishing') enriched.remediation = 'Force password reset, enable MFA, run anti-phish training, block sender domains.';
                else if (enriched.method === 'Vulnerability Exploitation') enriched.remediation = 'Patch vulnerable systems, apply virtual patching on WAF, rotate credentials.';
                else enriched.remediation = 'Investigate IOCs, isolate affected systems, notify stakeholders, and patch.';
            }
            if (!enriched.cost) {
                // Very simple cost guess depending on sector and method
                if (enriched.method === 'Ransomware') enriched.cost = 'Est. $1M - $50M (varies)';
                else if (enriched.method === 'Data Breach') enriched.cost = 'Est. $100k - $20M';
                else if (enriched.method === 'DDoS') enriched.cost = 'Est. $10k - $1M';
                else enriched.cost = 'Undisclosed';
            }
            return enriched;
        };

        // Save entries to a searchable local repository (localStorage) and prune older than 60 days.
        const saveToRepo = (entries) => {
            try {
                const key = 'cyber_repo_v1';
                const raw = localStorage.getItem(key);
                const now = Date.now();
                let repo = raw ? JSON.parse(raw) : [];
                // Merge by unique id
                const map = new Map(repo.map(r => [r.id, r]));
                entries.forEach(e => map.set(e.id, { ...map.get(e.id), ...e, savedAt: now }));
                let merged = Array.from(map.values());
                // prune older than 60 days
                const cutoff = now - 1000 * 60 * 60 * 24 * 60;
                merged = merged.filter(item => (item.savedAt || now) > cutoff);
                localStorage.setItem(key, JSON.stringify(merged));
                return merged;
            } catch (e) { return entries; }
        };

        const loadRepo = () => {
            const key = 'cyber_repo_v1';
            try {
                const raw = localStorage.getItem(key);
                return raw ? JSON.parse(raw) : [];
            } catch (e) { return []; }
        };

        const generateFallbackLiveEvents = () => {
            const today = new Date().toISOString().split('T')[0];
            return [
                {
                    id: 'simulated-1',
                    date: today,
                    target: "Global FinTech Clearinghouse",
                    sector: "Finance",
                    method: "DDoS",
                    attacker: "Killnet",
                    impact: "Transaction latency spikes detected globally.",
                    cost: "Undisclosed",
                    remediation: "Traffic scrubbing and geo-blocking initiated.",
                    source: "Live Monitor (Simulated)"
                }
            ];
        };

        // --- COMPONENTS (unchanged except for minor hooks) ---
        const TrendChart = ({ data }) => {
            const trend = data.reduce((acc, curr) => {
                if (!curr.date) return acc;
                const dateParts = curr.date.split('-');
                if (dateParts.length < 3) return acc;
                const dateKey = `${dateParts[0]}-${dateParts[1]}`; // YYYY-MM
                acc[dateKey] = (acc[dateKey] || 0) + 1;
                return acc;
            }, {});

            const entries = Object.entries(trend);
            entries.sort((a, b) => a[0].localeCompare(b[0]));

            const points = entries; 
            const maxVal = Math.max(...Object.values(trend)) || 1;

            const polylinePoints = points.map((p, i) => {
                const x = (i / (points.length - 1 || 1)) * 300; 
                const y = 100 - (p[1] / maxVal) * 80; 
                return `${x},${y}`;
            }).join(' ');

            return (
                <div className="w-full h-40 bg-slate-900 rounded-lg p-4 border border-slate-700 relative overflow-hidden">
                    <h4 className="text-xs font-bold text-slate-400 uppercase mb-2">Annual Incident Trend (2025)</h4>
                    <svg viewBox="0 0 300 100" className="w-full h-full overflow-visible">
                        <line x1="0" y1="100" x2="300" y2="100" stroke="#334155" strokeWidth="0.5"/>
                        {points.length > 1 && (
                            <>
                            <polyline points={polylinePoints} fill="none" stroke="#3b82f6" strokeWidth="3" className="drop-shadow-lg" />
                            <polygon points={`0,100 ${polylinePoints} 300,100`} fill="url(#gradient)" opacity="0.2" />
                            {points.map((p, i) => {
                                const x = (i / (points.length - 1 || 1)) * 300;
                                const y = 100 - (p[1] / maxVal) * 80;
                                return (
                                    <circle key={i} cx={x} cy={y} r="3" fill="#3b82f6" className="hover:r-5 transition-all">
                                        <title>{p[0]}: {p[1]} Incidents</title>
                                    </circle>
                                )
                            })}
                            </>
                        )}
                        <defs>
                            <linearGradient id="gradient" x1="0" x2="0" y1="0" y2="1">
                                <stop offset="0%" stopColor="#3b82f6" />
                                <stop offset="100%" stopColor="transparent" />
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
            );
        };

        const DailyReport = ({ data, date }) => {
            const daysEvents = data.filter(d => d.date === date);
            return (
                <div className="bg-white text-slate-900 p-8 max-w-4xl mx-auto rounded-none shadow-2xl slide-in font-serif">
                    <div className="border-b-4 border-black pb-4 mb-6 flex justify-between items-end">
                        <div>
                            <h1 className="text-3xl font-black uppercase tracking-tighter">Daily Cyber Intelligence Briefing</h1>
                            <p className="text-sm font-bold text-slate-500 mt-1">CLASSIFICATION: INTERNAL USE ONLY</p>
                        </div>
                        <div className="text-right">
                            <div className="text-xl font-bold font-mono">{date}</div>
                            <div className="text-xs uppercase">Report ID: {date.replace(/-/g, '')}-CS</div>
                        </div>
                    </div>
                    {daysEvents.length === 0 ? (
                        <div className="text-center py-10 italic text-slate-500">No major incidents recorded for this date in the feed. Select a different date or view the live dashboard.</div>
                    ) : (
                        <div className="space-y-6">
                            {daysEvents.map(evt => (
                                <div key={evt.id} className="border border-slate-200 p-4 bg-slate-50">
                                    <div className="flex justify-between items-start mb-2">
                                        <h3 className="text-lg font-bold text-red-700">{evt.target} <span className="text-black text-sm font-normal">({evt.sector})</span></h3>
                                        <span className="bg-black text-white px-2 py-0.5 text-xs font-bold uppercase">{evt.attacker}</span>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4 text-sm mb-3">
                                        <div><strong>Method:</strong> {evt.method}</div>
                                        <div><strong>Source:</strong> {evt.source}</div>
                                        <div className="col-span-2"><strong>Impact:</strong> {evt.impact}</div>
                                    </div>
                                    <div className="bg-red-50 border-l-4 border-red-600 p-2 text-sm text-red-900">
                                        <strong>RECOMMENDED ACTION:</strong><br/>
                                        {evt.remediation}
                                    </div>
                                    <div className="mt-3 text-xs text-slate-600">Estimated Cost: {evt.cost}</div>
                                </div>
                            ))}
                        </div>
                    )}
                    <div className="mt-8 pt-4 border-t border-slate-300 text-xs text-center text-slate-400 font-sans">
                        Generated by CyberSentinel v2.0 | Validated by SOC Team Alpha
                    </div>
                </div>
            );
        };

        function App() {
            const [view, setView] = useState('dashboard');
            const [searchTerm, setSearchTerm] = useState("");
            const [selectedEvent, setSelectedEvent] = useState(null);
            
            // State for Live Data
            const [liveData, setLiveData] = useState([]);
            const [isSyncing, setIsSyncing] = useState(false);
            const [lastUpdated, setLastUpdated] = useState("Never");

            // --- LIVE FETCHING LOGIC ---
            const fetchLiveFeeds = async () => {
                setIsSyncing(true);
                const allItems = [];

                // Use public CORS proxy (allorigins). This improves chances to fetch real feeds in browser.
                const proxyUrl = (feedUrl) => `https://api.allorigins.win/raw?url=${encodeURIComponent(feedUrl)}`;

                const fetchPromises = FEED_SOURCES.map(async (source) => {
                    try {
                        const response = await fetch(proxyUrl(source.url));
                        if (!response.ok) {
                           // try rss2json fallback
                           const rss2 = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(source.url)}`);
                           if (!rss2.ok) return;
                           const json = await rss2.json();
                           const items = json.items || [];
                           items.forEach((item, index) => {
                                const title = item.title || 'Unknown Event';
                                const description = item.description || item.content || 'No details available.';
                                const pubDateRaw = item.pubDate || item.pubDate || new Date().toISOString();
                                const dateObj = new Date(pubDateRaw);
                                const dateStr = isNaN(dateObj) ? new Date().toISOString().split('T')[0] : dateObj.toISOString().split('T')[0];
                                const { attacker, method, sector } = analyzeText(title + ' ' + (description || ''));
                                allItems.push(enrichEntry({
                                    id: `live-${source.name}-${index}`,
                                    date: dateStr,
                                    target: title,
                                    sector: sector,
                                    method: method,
                                    attacker: attacker,
                                    impact: description.replace(/<[^>]*>?/gm, '').substring(0, 300) + '...',
                                    cost: item.cost || undefined,
                                    remediation: item.remediation || undefined,
                                    source: source.name,
                                    link: item.link || item.url
                                }));
                           });
                           return;
                        }

                        const text = await response.text();
                        const parser = new DOMParser();
                        const xml = parser.parseFromString(text, "text/xml");
                        const items = xml.querySelectorAll("item");

                        items.forEach((item, index) => {
                            const title = item.querySelector("title")?.textContent || "Unknown Event";
                            const description = item.querySelector("description")?.textContent || item.querySelector("summary")?.textContent || "No details available.";
                            const pubDateRaw = item.querySelector("pubDate")?.textContent || item.querySelector('updated')?.textContent;
                            const dateObj = pubDateRaw ? new Date(pubDateRaw) : new Date();
                            const dateStr = isNaN(dateObj) ? new Date().toISOString().split('T')[0] : dateObj.toISOString().split('T')[0];
                            const { attacker, method, sector } = analyzeText(title + " " + description);

                            allItems.push(enrichEntry({
                                id: `live-${source.name}-${index}`,
                                date: dateStr,
                                target: title,
                                sector: sector,
                                method: method,
                                attacker: attacker,
                                impact: description.replace(/<[^>]*>?/gm, '').substring(0, 300) + "...",
                                cost: undefined,
                                remediation: undefined,
                                source: source.name,
                                link: item.querySelector("link")?.textContent
                            }));
                        });
                    } catch (error) {
                        // suppress errors to keep UI stable
                    }
                });

                await Promise.all(fetchPromises);

                // FALLBACK: If network blocks fetch entirely, generate simulated live events for today
                if (allItems.length === 0) {
                    const simulated = generateFallbackLiveEvents();
                    allItems.push(...simulated);
                }

                // Merge with local repo and archive
                const repoMerged = saveToRepo(allItems);
                // combine repo (most trusted) and recent items, sort by date
                const combined = [...repoMerged].sort((a, b) => new Date(b.date) - new Date(a.date));
                setLiveData(combined);
                setLastUpdated(new Date().toLocaleTimeString());
                setIsSyncing(false);
            };

            // Initial Fetch
            useEffect(() => {
                // Load repo into state first
                const existing = loadRepo();
                if (existing.length) setLiveData(existing.sort((a,b)=> new Date(b.date)-new Date(a.date)));
                // then fetch new feeds
                fetchLiveFeeds();
            }, []);

            const filteredData = useMemo(() => {
                return liveData.filter(item => 
                    item.target.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    (item.attacker || '').toLowerCase().includes(searchTerm.toLowerCase()) ||
                    (item.method || '').toLowerCase().includes(searchTerm.toLowerCase()) ||
                    (item.date || '').includes(searchTerm)
                );
            }, [liveData, searchTerm]);

            return (
                <div className="min-h-screen pb-10">
                    {/* NAV */}
                    <nav className="bg-slate-900 border-b border-slate-800 sticky top-0 z-50">
                        <div className="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <div className="w-3 h-3 bg-red-500 rounded-full pulse-dot"></div>
                                <span className="font-bold text-lg tracking-widest font-mono">CYBER<span className="text-blue-500">SENTINEL</span></span>
                            </div>
                            <div className="flex items-center gap-4">
                                <div className="hidden md:block text-right mr-2">
                                    <div className="text-[10px] text-slate-500 uppercase font-bold">Live Feed Status</div>
                                    <div className="text-xs font-mono text-emerald-400 flex items-center justify-end gap-1">
                                        {isSyncing ? "SYNCING..." : "ONLINE"} 
                                        <span className="w-1.5 h-1.5 bg-emerald-400 rounded-full"></span>
                                    </div>
                                </div>
                                <button onClick={() => setView('dashboard')} className={`px-4 py-2 text-sm font-medium rounded-md transition-colors ${view === 'dashboard' ? 'bg-blue-600 text-white' : 'text-slate-400 hover:text-white'}`}>Live Dashboard</button>
                                <button onClick={() => setView('report')} className={`px-4 py-2 text-sm font-medium rounded-md transition-colors ${view === 'report' ? 'bg-blue-600 text-white' : 'text-slate-400 hover:text-white'}`}>Briefings</button>
                                <button onClick={fetchLiveFeeds} className="p-2 text-slate-400 hover:text-white rounded-full hover:bg-slate-800 transition-all" title="Refresh Feed">
                                    <svg className={`w-5 h-5 ${isSyncing ? 'animate-spin' : ''}`} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
                                </button>
                            </div>
                        </div>
                    </nav>

                    {/* DASHBOARD VIEW */}
                    {view === 'dashboard' && (
                        <main className="max-w-7xl mx-auto px-4 mt-8 space-y-6 slide-in">
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div className="bg-slate-800 p-5 rounded-lg border border-slate-700">
                                    <h3 className="text-xs text-slate-400 font-bold uppercase">Total Events Logged</h3>
                                    <div className="text-3xl font-mono font-bold mt-1 text-white">{liveData.length}</div>
                                    <div className="text-xs text-slate-500 mt-1">Full 2025 Timeline + Live Feeds</div>
                                </div>
                                <div className="bg-slate-800 p-5 rounded-lg border border-slate-700">
                                    <h3 className="text-xs text-slate-400 font-bold uppercase">Last Sync</h3>
                                    <div className="text-xl font-mono font-bold mt-2 text-emerald-400">{lastUpdated}</div>
                                </div>
                                <div className="bg-slate-800 p-5 rounded-lg border border-slate-700">
                                    <h3 className="text-xs text-slate-400 font-bold uppercase">Active Sources</h3>
                                    <div className="text-3xl font-mono font-bold mt-1 text-blue-400">{FEED_SOURCES.length}</div>
                                </div>
                                <div className="bg-slate-800 p-5 rounded-lg border border-slate-700">
                                    <h3 className="text-xs text-slate-400 font-bold uppercase">Critical Threats</h3>
                                    <div className="text-3xl font-mono font-bold mt-1 text-red-500">{liveData.filter(i => i.method === "Ransomware" || i.method === "Vulnerability Exploitation").length}</div>
                                    <div className="text-xs text-slate-500 mt-1">Ransomware / 0-Day</div>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div className="md:col-span-2">
                                    <TrendChart data={liveData} />
                                    <div className="mt-6 flex gap-2">
                                        <input type="text" placeholder="Search entire archive..." className="flex-1 bg-slate-800 border border-slate-700 rounded-lg p-3 text-sm focus:outline-none focus:border-blue-500 text-white font-mono" onChange={(e) => setSearchTerm(e.target.value)} />
                                        {isSyncing && <span className="text-xs text-slate-500 self-center">Fetching updates...</span>}
                                    </div>

                                    <div className="mt-4 bg-slate-800 rounded-lg border border-slate-700 overflow-hidden">
                                        <div className="overflow-x-auto">
                                            <table className="w-full text-left text-sm">
                                                <thead className="bg-slate-900 text-slate-400 uppercase text-xs font-bold">
                                                    <tr>
                                                        <th className="p-4">Date</th>
                                                        <th className="p-4">Event / Target</th>
                                                        <th className="p-4">Method</th>
                                                        <th className="p-4">Source</th>
                                                        <th className="p-4 text-right">Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody className="divide-y divide-slate-700">
                                                    {filteredData.slice(0, 50).map(row => (
                                                        <tr key={row.id} className="hover:bg-slate-700/50 transition-colors">
                                                            <td className="p-4 font-mono text-slate-400 whitespace-nowrap">{row.date}</td>
                                                            <td className="p-4">
                                                                <div className="font-bold text-white line-clamp-1">{row.target}</div>
                                                                <div className="text-xs text-slate-500">{row.sector}</div>
                                                            </td>
                                                            <td className="p-4 text-slate-300">{row.method}</td>
                                                            <td className="p-4"><span className="text-xs bg-slate-900 px-2 py-1 rounded border border-slate-600 text-slate-400 whitespace-nowrap">{row.source}</span></td>
                                                            <td className="p-4 text-right">
                                                                <button onClick={() => setSelectedEvent(row)} className="text-blue-400 hover:underline">View</button>
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-slate-800 p-6 rounded-lg border border-slate-700 h-fit">
                                    <h4 className="text-xs font-bold text-slate-400 uppercase mb-4 text-center">Live Intelligence Feeds</h4>
                                    <ul className="space-y-3">
                                        {FEED_SOURCES.map((src, i) => (
                                            <li key={i} className="flex items-center gap-3 text-sm text-slate-300">
                                                <span className="w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]"></span>
                                                {src.name}
                                            </li>
                                        ))}
                                    </ul>
                                    <div className="mt-6 p-4 bg-slate-900/50 rounded border border-slate-800 text-xs text-slate-500 leading-relaxed">
                                        <strong className="block text-slate-400 mb-2">System Note:</strong>
                                        This dashboard aggregates real-time RSS feeds from at least 5 public security sources. Data is stored locally in a searchable repository (browser storage) and kept for 60 days for continuous reporting.
                                    </div>
                                </div>
                            </div>
                        </main>
                    )}

                    {/* REPORT VIEW */}
                    {view === 'report' && (
                        <main className="max-w-4xl mx-auto mt-8 px-4">
                            {/* Pass the most recent date from data to the report */}
                            <DailyReport data={liveData} date={liveData[0]?.date || new Date().toISOString().split('T')[0]} />
                        </main>
                    )}

                    {/* MODAL */}
                    {selectedEvent && (
                        <div className="fixed inset-0 bg-black/90 z-[100] flex items-center justify-center p-4">
                            <div className="bg-slate-900 w-full max-w-2xl rounded-xl border border-slate-700 shadow-2xl overflow-hidden relative slide-in">
                                <button onClick={() => setSelectedEvent(null)} className="absolute top-4 right-4 text-slate-500 hover:text-white"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
                                <div className="p-8">
                                    <div className="flex items-center gap-3 mb-2">
                                        <span className="bg-blue-600 text-white px-2 py-0.5 text-xs font-bold uppercase tracking-wider rounded">{selectedEvent.source}</span>
                                        <span className="text-slate-500 font-mono text-sm">{selectedEvent.date}</span>
                                    </div>
                                    <h2 className="text-xl font-bold text-white mb-4">{selectedEvent.target}</h2>
                                    <div className="grid grid-cols-2 gap-6 mb-6">
                                        <div className="bg-slate-950 p-4 rounded border border-slate-800">
                                            <div className="text-xs text-slate-500 uppercase font-bold">Suspected Actor</div>
                                            <div className="text-red-400 font-mono">{selectedEvent.attacker}</div>
                                        </div>
                                        <div className="bg-slate-950 p-4 rounded border border-slate-800">
                                            <div className="text-xs text-slate-500 uppercase font-bold">Method</div>
                                            <div className="text-emerald-400 font-mono">{selectedEvent.method}</div>
                                        </div>
                                    </div>
                                    <div className="space-y-4">
                                        <div>
                                            <h3 className="text-sm font-bold text-white uppercase mb-2">Details</h3>
                                            <p className="text-slate-300 text-sm leading-relaxed bg-slate-800/50 p-3 rounded border border-slate-700">{selectedEvent.impact}</p>
                                        </div>
                                        {selectedEvent.link && (
                                            <a href={selectedEvent.link} target="_blank" className="inline-block text-blue-400 hover:text-blue-300 text-sm mt-2 font-medium">Read Full Article &rarr;</a>
                                        )}
                                        <div>
                                            <h3 className="text-sm font-bold text-yellow-500 uppercase mb-2">Remediation Strategy</h3>
                                            <div className="bg-yellow-900/10 border-l-4 border-yellow-500 p-4 text-yellow-100 text-sm">
                                                {selectedEvent.remediation}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-slate-950 p-4 text-right border-t border-slate-800">
                                    <button onClick={() => setSelectedEvent(null)} className="px-4 py-2 bg-slate-800 hover:bg-slate-700 rounded text-sm text-white transition-colors">Close</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
